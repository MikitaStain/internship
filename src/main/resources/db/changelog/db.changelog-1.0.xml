<?xml version = "1.0" encoding = "UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
      http://www.liquibase.org/xml/ns/pro
      http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">


    <changeSet id="1" author="mikita">

        <comment>Table positions</comment>

        <sql>
            CREATE TABLE IF NOT EXISTS application.positions
            (
            position_id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE
            9223372036854775807 CACHE 1 ),
            name character varying(255) COLLATE pg_catalog."default",
            CONSTRAINT positions_pkey PRIMARY KEY (position_id)
            )
        </sql>

        <rollback>
            DROP TABLE positions;
        </rollback>

    </changeSet>

    <changeSet id="2" author="mikita">

        <comment>Table courses</comment>

        <sql>
            CREATE TABLE IF NOT EXISTS application.courses
            (
            course_id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE
            9223372036854775807 CACHE 1 ),
            name character varying(255) COLLATE pg_catalog."default",
            CONSTRAINT courses_pkey PRIMARY KEY (course_id)
            )
        </sql>

        <rollback>
            DROP TABLE courses;
        </rollback>

    </changeSet>

    <changeSet id="3" author="mikita">

        <comment>Table users</comment>

        <sql>
            CREATE TABLE IF NOT EXISTS application.users
            (
            user_id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE
            9223372036854775807 CACHE 1 ),
            last_name character varying(255) COLLATE pg_catalog."default",
            login character varying(255) COLLATE pg_catalog."default",
            name character varying(255) COLLATE pg_catalog."default",
            password character varying(255) COLLATE pg_catalog."default",
            role integer,
            position_id bigint,
            CONSTRAINT users_pkey PRIMARY KEY (user_id)
            )
        </sql>

        <rollback>
            DROP TABLE users;
        </rollback>

    </changeSet>

    <changeSet id="4" author="mikita">

        <comment>Table emails</comment>

        <sql>
            CREATE TABLE IF NOT EXISTS application.emails
            (
            email_id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE
            9223372036854775807 CACHE 1 ),
            email character varying(255) COLLATE pg_catalog."default",
            user_id bigint,
            CONSTRAINT emails_pkey PRIMARY KEY (email_id),
            CONSTRAINT fk41wb6kvdemvj1602iltrfr1uo FOREIGN KEY (user_id)
            REFERENCES application.users (user_id) MATCH SIMPLE
            ON UPDATE NO ACTION
            ON DELETE NO ACTION
            )
        </sql>

        <rollback>
            DROP TABLE emails;
        </rollback>

    </changeSet>

    <changeSet id="5" author="mikita">

        <comment>Table user_courses</comment>

        <sql>
            CREATE TABLE IF NOT EXISTS application.user_courses
            (
            user_id bigint NOT NULL,
            course_id bigint NOT NULL,
            CONSTRAINT user_courses_pkey PRIMARY KEY (user_id, course_id),
            CONSTRAINT fk5i2mwg17kvpk92fy6cdii93da FOREIGN KEY (user_id)
            REFERENCES application.users (user_id) MATCH SIMPLE
            ON UPDATE NO ACTION
            ON DELETE NO ACTION,
            CONSTRAINT fkb84hga2qpwc4vv44lmyb8mwux FOREIGN KEY (course_id)
            REFERENCES application.courses (course_id) MATCH SIMPLE
            ON UPDATE NO ACTION
            ON DELETE NO ACTION
            )

        </sql>

        <rollback>
            DROP TABLE user_courses;
        </rollback>

    </changeSet>

</databaseChangeLog>